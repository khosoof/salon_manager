import 'package:dio/dio.dart';class DioClient{final Dio _dio;String? _accessToken;String? _refreshToken;DioClient(String baseUrl):_dio=Dio(BaseOptions(baseUrl:baseUrl,connectTimeout:Duration(seconds:8),receiveTimeout:Duration(seconds:10))){_dio.interceptors.add(InterceptorsWrapper(onRequest:(o,h){if(_accessToken!=null){o.headers['Authorization']='Bearer '+_accessToken!;}return h.next(o);},onError:(e,h) async{if(e.response?.statusCode==401&&_refreshToken!=null){try{final res=await _dio.post('/auth/refresh',data:{'refresh_token':_refreshToken});_accessToken=res.data['access_token'];e.requestOptions.headers['Authorization']='Bearer '+_accessToken!;final clone=await _dio.fetch(e.requestOptions);return h.resolve(clone);}catch(_){}}return h.next(e);}));}void setTokens({required String access,required String refresh}){_accessToken=access;_refreshToken=refresh;}Dio get raw=>_dio;}
